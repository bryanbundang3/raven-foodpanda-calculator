<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>PandaRemit</title>
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --fp-pink: #d70466;
            --fp-pink-muted: #b00354;
            --fp-black: #1a1a1a;
            --bg-matte: #f4f4f4;
            --text-gray: #555;
            --remit-red: #b03024;
            --gross-green: #219653;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Lexend', sans-serif;
            background-color: var(--bg-matte);
            /* Opacity increased to 15% for a highly visible matte texture */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.15'/%3E%3C/svg%3E");
            color: var(--fp-black);
            margin: 0;
            padding: env(safe-area-inset-top) 20px 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header { text-align: center; margin-bottom: 30px; margin-top: 25px; }
        .logo { width: 75px; height: 75px; fill: var(--fp-black); margin-bottom: 10px; }
        h1 { margin: 0; font-size: 26px; font-weight: 700; color: var(--fp-pink-muted); }
        .subtitle { font-size: 16px; color: var(--text-gray); font-weight: 300; margin-top: 4px; }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 380px;
            margin-bottom: 20px;
        }

        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 10px; font-size: 16px; font-weight: 400; color: var(--fp-black); }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .currency-symbol {
            position: absolute;
            left: 18px;
            font-size: 18px;
            font-weight: 600;
            color: var(--fp-black);
        }
        input {
            width: 100%;
            padding: 16px 16px 16px 45px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Lexend', sans-serif;
            font-size: 18px;
            background: #fafafa;
            color: var(--fp-black);
            font-weight: 600;
        }
        input:focus { outline: none; border-color: var(--fp-pink-muted); background: white; }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-family: 'Lexend', sans-serif;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-main { background: var(--fp-black); color: white; margin-top: 10px; }
        
        /* 1-Tap Install Button - Hidden by default until Android allows it */
        #install-btn { background: var(--fp-pink-muted); color: white; margin-bottom: 20px; display: none; max-width: 380px; }

        .btn-clear { background: transparent; color: var(--text-gray); font-weight: 400; font-size: 15px; margin-top: 15px; text-decoration: underline; }
        .btn-history { background: #e0e0e0; color: var(--fp-black); font-size: 14px; padding: 10px 15px; margin-top: 25px; width: auto; border-radius: 8px; font-weight: 600; }

        /* Restyled Result Display Cards */
        .result-box {
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
        }
        .remit-bg { background: #fdf2f2; border: 1px solid #fadbd8; }
        .gross-bg { background: #f0fdf4; border: 1px solid #d4efdf; }
        
        .result-title { display: block; font-size: 16px; margin-bottom: 10px; font-weight: 600; }
        .result-flex { display: flex; justify-content: space-between; align-items: center; }
        .result-val { font-weight: 700; font-size: 26px; }
        
        .remit-text { color: var(--remit-red); }
        .gross-text { color: var(--gross-green); }

        .btn-copy { background: white; color: var(--remit-red); border: 2px solid var(--remit-red); padding: 8px 16px; font-size: 14px; border-radius: 8px; width: auto; font-weight: 700; }

        #history-section { width: 100%; max-width: 380px; margin-top: 35px; font-size: 14px; border-top: 2px solid #ddd; padding-top: 20px; }
        .history-item { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; color: var(--fp-black); }
        .history-date { font-weight: 700; font-style: italic; display: block; margin-bottom: 4px; font-size: 13px; }

        .footer-note { margin-top: auto; padding-top: 50px; font-style: italic; color: #888; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <header>
        <svg class="logo" viewBox="0 0 500 500">
            <path d="M250 20C123 20 20 123 20 250s103 230 230 230 230-103 230-230S377 20 250 20zm87.5 130c20.7 0 37.5 16.8 37.5 37.5s-16.8 37.5-37.5 37.5-37.5-16.8-37.5-37.5 16.8-37.5 37.5-37.5zM162.5 150c20.7 0 37.5 16.8 37.5 37.5s-16.8 37.5-37.5 37.5-37.5-16.8-37.5-37.5 16.8-37.5 37.5-37.5zm87.5 240c-69 0-125-56-125-125h250c0 69-56 125-125 125z"/>
        </svg>
        <h1>Foodpanda</h1>
        <div class="subtitle">Remittance Calculator for Raven</div>
    </header>

    <button id="install-btn" class="btn">ðŸ“² Download App</button>

    <div class="card">
        <div class="input-group">
            <label>ðŸ‘› <b>Wallet</b> Amount</label>
            <div class="input-wrapper">
                <span class="currency-symbol">â‚±</span>
                <input type="number" id="wallet" placeholder="0.00" step="0.01" inputmode="decimal">
            </div>
        </div>
        <div class="input-group">
            <label>ðŸ’µ Total <b>Payment</b></label>
            <div class="input-wrapper">
                <span class="currency-symbol">â‚±</span>
                <input type="number" id="earnings" placeholder="0.00" step="0.01" inputmode="decimal">
            </div>
        </div>
        <button class="btn btn-main" onclick="calculate()">Calculate</button>
    </div>

    <div class="card" id="result-card" style="display:none;">
        <div class="result-box remit-bg">
            <span class="result-title remit-text">ðŸ’¸ Amount to Remit:</span>
            <div class="result-flex">
                <span class="result-val remit-text" id="res-remit">â‚±0.00</span>
                <button class="btn btn-copy" id="copy-btn" onclick="copyRemit()">Copy</button>
            </div>
        </div>
        
        <div class="result-box gross-bg">
            <span class="result-title gross-text">ðŸ¤‘ Gross Earnings:</span>
            <div class="result-flex">
                <span class="result-val gross-text" id="res-gross">â‚±0.00</span>
            </div>
        </div>
    </div>

    <button class="btn btn-clear" onclick="clearAll()">Clear All</button>
    <button class="btn btn-history" onclick="saveHistory()">Save to History</button>

    <div id="history-section">
        <div id="history-list"></div>
    </div>

    <div class="footer-note">
        Ingat lagi, wag ka magpasagasa dyan. ðŸ˜˜
    </div>

    <script>
        // Auto-format decimals on tap outside the box
        document.getElementById('wallet').addEventListener('blur', function() {
            if(this.value) this.value = parseFloat(this.value).toFixed(2);
        });
        document.getElementById('earnings').addEventListener('blur', function() {
            if(this.value) this.value = parseFloat(this.value).toFixed(2);
        });

        function formatNum(num) {
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function calculate() {
            const wallet = parseFloat(document.getElementById('wallet').value) || 0;
            const total = parseFloat(document.getElementById('earnings').value) || 0;
            
            const gross = total * 0.98;
            const remit = wallet - gross;

            document.getElementById('res-gross').innerText = 'â‚±' + formatNum(gross);
            document.getElementById('res-remit').innerText = 'â‚±' + formatNum(remit);
            document.getElementById('result-card').style.display = 'block';
        }

        function copyRemit() {
            const val = document.getElementById('res-remit').innerText.replace('â‚±', '').replace(/,/g, '');
            navigator.clipboard.writeText(val);
            const btn = document.getElementById('copy-btn');
            btn.innerText = "Copied!";
            btn.style.backgroundColor = "var(--remit-red)";
            btn.style.color = "white";
            setTimeout(() => { 
                btn.innerText = "Copy"; 
                btn.style.backgroundColor = "white";
                btn.style.color = "var(--remit-red)";
            }, 2000);
        }

        function clearAll() {
            document.getElementById('wallet').value = '';
            document.getElementById('earnings').value = '';
            document.getElementById('result-card').style.display = 'none';
        }

        function saveHistory() {
            const remit = document.getElementById('res-remit').innerText;
            const gross = document.getElementById('res-gross').innerText;
            if(remit === "â‚±0.00") return;

            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            
            const entry = { date: dateStr, remit, gross };
            let history = JSON.parse(localStorage.getItem('pandaHistory') || '[]');
            history.unshift(entry);
            if(history.length > 5) history.pop();
            localStorage.setItem('pandaHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('pandaHistory') || '[]');
            const list = document.getElementById('history-list');
            list.innerHTML = history.map(item => `
                <div class="history-item">
                    <span class="history-date">${item.date}</span>
                    Amount to Remit: <b>${item.remit}</b><br>
                    Gross Earnings: <b>${item.gross}</b>
                </div>
            `).join('');
        }

        window.onload = renderHistory;

        // PWA Install Logic (Path 1)
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block'; // Show the button when Android allows install
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
